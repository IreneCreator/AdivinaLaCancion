<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adivina el Hit 2025 - Offline Ready</title>
    <!-- Tailwind via CDN - Se incluye estilo de respaldo por si no hay red para el CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: white; -webkit-tap-highlight-color: transparent; }
        
        /* Animaciones */
        .spin-anim { animation: roll 0.1s linear infinite; }
        @keyframes roll {
            from { transform: translateY(-10px); opacity: 0.5; }
            to { transform: translateY(10px); opacity: 0.5; }
        }
        .all-in-glow {
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
            animation: pulse-glow 1.5s infinite;
        }
        @keyframes pulse-glow {
            0%, 100% { border-color: rgba(99, 102, 241, 0.8); background-color: rgba(30, 27, 75, 0.4); }
            50% { border-color: rgba(168, 85, 247, 0.8); background-color: rgba(49, 46, 129, 0.6); }
        }
        
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }

        /* Clases de utilidad manuales por si falla Tailwind offline */
        .bg-slate-800-fallback { background-color: #1e293b; }
        .bg-slate-900-fallback { background-color: #0f172a; }
    </style>
</head>
<body class="min-h-screen p-4 max-w-6xl mx-auto overflow-x-hidden">

    <!-- HEADER -->
    <header class="flex flex-col sm:flex-row justify-between items-center mb-8 border-b border-slate-700 pb-4 gap-4">
        <div class="flex items-center gap-3">
            <div class="bg-gradient-to-br from-purple-500 to-pink-500 p-2 rounded-lg shadow-lg">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
            </div>
            <div>
                <h1 class="text-2xl font-black bg-gradient-to-r from-white to-slate-400 bg-clip-text text-transparent uppercase tracking-tighter italic">ADIVINA EL HIT ü•Ç</h1>
                <p class="text-slate-500 text-[10px] uppercase font-bold tracking-widest italic">Nochevieja 2025</p>
            </div>
        </div>
        
        <div class="flex items-center gap-3 bg-slate-800 p-3 px-5 rounded-2xl border border-slate-700 shadow-2xl relative overflow-hidden">
             <div class="absolute top-0 left-0 w-1 h-full bg-yellow-500 opacity-50"></div>
             <div class="text-right">
                <span class="text-[10px] block text-slate-400 font-black uppercase tracking-widest mb-1">Bote en Juego</span>
                <div class="flex items-center gap-1 justify-end">
                    <span id="bote-display" class="text-3xl font-black text-yellow-400 tabular-nums">5</span>
                    <span class="text-[10px] text-yellow-600 font-black uppercase">pts</span>
                </div>
             </div>
             <div class="h-12 w-px bg-slate-700 mx-2"></div>
             <div class="grid grid-cols-2 gap-1.5">
                <button onclick="updateBote(5)" class="bg-emerald-600/20 text-emerald-400 border border-emerald-500/30 p-1 px-3 rounded-lg hover:bg-emerald-600/40 transition font-black text-[9px] uppercase">+5</button>
                <button onclick="resetBote()" class="bg-slate-700/50 text-slate-400 border border-slate-600/30 p-1 px-3 rounded-lg hover:bg-slate-700 transition font-black text-[9px] uppercase">Reset</button>
                <button onclick="degradeBote()" class="col-span-2 bg-rose-600/20 text-rose-400 border border-rose-500/30 p-1 px-3 rounded-lg hover:bg-rose-600/40 transition font-black text-[9px] uppercase tracking-tighter">Degradar</button>
             </div>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- SECCI√ìN IZQUIERDA: CLASIFICACI√ìN -->
        <section class="lg:col-span-2 space-y-4">
            <div class="bg-slate-800/40 rounded-[2rem] p-6 border border-slate-700/50 backdrop-blur-xl shadow-2xl">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                    <h2 class="text-lg font-bold flex items-center gap-2 uppercase tracking-tight italic">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#a855f7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                        Clasificaci√≥n
                    </h2>
                    <div class="flex gap-2 w-full sm:w-auto">
                        <input type="text" id="team-input" placeholder="Nuevo equipo..." class="flex-1 sm:w-40 bg-slate-900 border border-slate-700 rounded-xl px-4 py-1.5 text-xs focus:ring-1 focus:ring-purple-500 outline-none placeholder:text-slate-700 text-white">
                        <button onclick="addTeam()" class="bg-purple-600 hover:bg-purple-500 p-2 rounded-xl transition shadow-lg shadow-purple-900/40 active:scale-90">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><line x1="19" y1="8" x2="19" y2="14"></line><line x1="16" y1="11" x2="22" y2="11"></line></svg>
                        </button>
                    </div>
                </div>
                
                <div id="teams-container" class="space-y-3">
                    <!-- Teams inject here -->
                </div>
            </div>
        </section>

        <!-- SECCI√ìN DERECHA: RULETA Y LOGS -->
        <section class="space-y-4">
            <!-- RULETA -->
            <div class="bg-slate-800/40 rounded-[2rem] p-6 border border-slate-700/50 shadow-xl backdrop-blur-md relative group">
                <div id="roulette-display" class="w-full h-28 rounded-2xl flex items-center justify-center text-center p-4 mb-4 transition-all duration-500 shadow-inner border-2 border-white/5 bg-slate-900 text-slate-700 italic">
                    <span class="text-xl font-black uppercase tracking-widest leading-tight">Pulsa el bot√≥n</span>
                </div>
                <button onclick="spin()" id="spin-btn" class="w-full py-5 rounded-2xl bg-gradient-to-r from-pink-600 to-purple-600 font-black text-lg hover:shadow-2xl hover:shadow-purple-500/40 transition-all active:scale-95 flex items-center justify-center gap-3 uppercase tracking-wider overflow-hidden group/spin">
                    <svg id="spin-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path></svg>
                    <span>¬°Sortear G√©nero!</span>
                </button>
            </div>

            <!-- G√âNEROS -->
            <div class="bg-slate-800/40 rounded-[2rem] p-6 border border-slate-700/50">
                <h3 class="text-[10px] font-black text-slate-500 mb-4 tracking-widest uppercase flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
                    Repertorio de Estilos
                </h3>
                <div class="flex gap-2 mb-4">
                    <input type="text" id="cat-input" placeholder="Nuevo g√©nero..." class="flex-1 bg-slate-900 border border-slate-800 rounded-xl px-3 py-2 text-xs outline-none focus:border-pink-500 transition-colors text-slate-300">
                    <button onclick="addCategory()" class="bg-slate-800 p-2 rounded-xl border border-slate-700 hover:bg-slate-700 active:scale-90 shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    </button>
                </div>
                <div id="categories-container" class="flex flex-wrap gap-1.5 max-h-40 overflow-y-auto custom-scrollbar pr-2">
                    <!-- Categories inject here -->
                </div>
            </div>

            <!-- MONITOR -->
            <div class="bg-slate-900/50 rounded-2xl p-4 border border-slate-800/50">
                <h4 class="text-[8px] font-black text-slate-600 mb-2 uppercase tracking-[0.2em] flex items-center gap-1.5">
                    <div class="w-1 h-1 rounded-full bg-emerald-500 animate-pulse"></div>
                    Monitor de Partida
                </h4>
                <div id="logs-container" class="space-y-1.5">
                    <!-- Logs inject here -->
                </div>
            </div>
        </section>
    </div>

    <script>
        // CONFIGURACI√ìN Y ESTADO INICIAL
        const DEFAULT_CATEGORIES = [
            { id: 1, name: 'Perreo Old School', color: 'bg-pink-500' },
            { id: 2, name: 'Camp Rock & Disney', color: 'bg-blue-400' },
            { id: 3, name: 'Pop Espa√±ol 2000', color: 'bg-yellow-500' },
            { id: 4, name: 'Himnos Actuales', color: 'bg-purple-600' },
            { id: 5, name: 'La de los Padres', color: 'bg-orange-500' }
        ];

        let state = {
            teams: JSON.parse(localStorage.getItem('h25_teams')) || [],
            categories: JSON.parse(localStorage.getItem('h25_cats')) || DEFAULT_CATEGORIES,
            bote: 5,
            allInId: null,
            logs: [],
            isSpinning: false
        };

        // PERSISTENCIA
        function save() {
            localStorage.setItem('h25_teams', JSON.stringify(state.teams));
            localStorage.setItem('h25_cats', JSON.stringify(state.categories));
            render();
        }

        // ACCIONES DE BOTE
        function updateBote(val) {
            state.bote += val;
            renderBote();
        }

        function resetBote() {
            state.bote = 5;
            renderBote();
        }

        function degradeBote() {
            const dec = Math.max(1, Math.floor(state.bote / 5));
            state.bote = Math.max(0, state.bote - dec);
            renderBote();
        }

        function renderBote() {
            document.getElementById('bote-display').innerText = state.bote;
        }

        // GESTI√ìN DE EQUIPOS
        function addTeam() {
            const input = document.getElementById('team-input');
            const name = input.value.trim();
            if (name) {
                state.teams.push({
                    id: Date.now(),
                    name: name,
                    points: 0,
                    shield: true
                });
                input.value = '';
                save();
            }
        }

        function deleteTeam(id) {
            if(confirm('¬øEliminar equipo?')) {
                state.teams = state.teams.filter(t => t.id !== id);
                if (state.allInId === id) state.allInId = null;
                save();
            }
        }

        function toggleShield(id) {
            const team = state.teams.find(t => t.id === id);
            team.shield = !team.shield;
            save();
        }

        function toggleAllIn(id) {
            state.allInId = (state.allInId === id) ? null : id;
            render();
        }

        function handleResult(id, win) {
            const team = state.teams.find(t => t.id === id);
            const isAllIn = state.allInId === id;
            const multiplier = isAllIn ? 2 : 1;
            const points = state.bote * multiplier;
            
            const finalPoints = win ? points : -points;
            team.points += finalPoints;

            addLog(`${team.name} ${win ? '‚úÖ' : '‚ùå'} (${isAllIn ? 'TODO O NADA' : 'BOTE'}: ${finalPoints} pts)`);

            if (win) {
                state.bote = 5;
                state.allInId = null;
                renderBote();
            } else {
                state.allInId = null;
            }
            save();
        }

        // GESTI√ìN DE CATEGOR√çAS
        function addCategory() {
            const input = document.getElementById('cat-input');
            const name = input.value.trim();
            if (name) {
                const colors = ['bg-red-500', 'bg-blue-500', 'bg-emerald-500', 'bg-yellow-500', 'bg-purple-500', 'bg-pink-500', 'bg-indigo-500', 'bg-orange-500'];
                state.categories.push({
                    id: Date.now(),
                    name: name,
                    color: colors[Math.floor(Math.random() * colors.length)]
                });
                input.value = '';
                save();
            }
        }

        function deleteCategory(id) {
            state.categories = state.categories.filter(c => c.id !== id);
            save();
        }

        // RULETA
        function spin() {
            if (state.isSpinning || state.categories.length === 0) return;
            
            state.isSpinning = true;
            const btn = document.getElementById('spin-btn');
            const display = document.getElementById('roulette-display');
            const icon = document.getElementById('spin-icon');
            
            btn.disabled = true;
            icon.classList.add('animate-spin');

            let iterations = 0;
            const interval = setInterval(() => {
                const cat = state.categories[Math.floor(Math.random() * state.categories.length)];
                display.innerHTML = `<span class="text-xl font-black uppercase tracking-widest leading-tight spin-anim">${cat.name}</span>`;
                display.className = `w-full h-28 rounded-2xl flex items-center justify-center text-center p-4 mb-4 transition-all duration-300 shadow-inner border-2 border-white/5 ${cat.color}`;
                
                iterations++;
                if (iterations > 20) {
                    clearInterval(interval);
                    state.isSpinning = false;
                    btn.disabled = false;
                    icon.classList.remove('animate-spin');
                    // Fijar el resultado final (quitar animacion de texto)
                    const finalCat = state.categories[Math.floor(Math.random() * state.categories.length)];
                    display.innerHTML = `<span class="text-xl font-black uppercase tracking-widest leading-tight">${finalCat.name}</span>`;
                    display.className = `w-full h-28 rounded-2xl flex items-center justify-center text-center p-4 mb-4 transition-all duration-500 shadow-inner border-2 border-white/5 ${finalCat.color} shadow-black/40`;
                }
            }, 100);
        }

        // LOGS
        function addLog(msg) {
            const time = new Date().toLocaleTimeString();
            state.logs.unshift(`[${time}] ${msg}`);
            if (state.logs.length > 5) state.logs.pop();
            renderLogs();
        }

        function renderLogs() {
            const container = document.getElementById('logs-container');
            if (state.logs.length === 0) {
                container.innerHTML = `<div class="text-[9px] text-slate-800 italic uppercase font-bold text-center py-2">Esperando jugada...</div>`;
                return;
            }
            container.innerHTML = state.logs.map((l, i) => `
                <div class="text-[9px] font-mono border-l-2 pl-2 truncate italic py-0.5 ${i === 0 ? 'text-indigo-400 border-indigo-500' : 'text-slate-600 border-slate-800'}">
                    ${l}
                </div>
            `).join('');
        }

        // RENDERIZADO GENERAL
        function render() {
            // RENDER TEAMS
            const teamsContainer = document.getElementById('teams-container');
            const sortedTeams = [...state.teams].sort((a, b) => b.points - a.points);
            
            if (sortedTeams.length === 0) {
                teamsContainer.innerHTML = `<div class="text-center py-16 border-2 border-dashed border-slate-800 rounded-[2.5rem] text-slate-700 font-black uppercase tracking-widest italic opacity-50">Configura los equipos para empezar</div>`;
            } else {
                teamsContainer.innerHTML = sortedTeams.map((team, idx) => {
                    const isAllIn = state.allInId === team.id;
                    return `
                        <div class="flex flex-col sm:flex-row items-center justify-between p-4 sm:p-5 rounded-3xl border transition-all duration-300 gap-4 ${isAllIn ? 'all-in-glow scale-[1.02]' : (idx === 0 ? 'bg-gradient-to-r from-purple-900/20 to-slate-900/40 border-purple-500/30 shadow-lg' : 'bg-slate-900/60 border-slate-800')}">
                            <div class="flex items-center gap-4 w-full sm:w-auto">
                                <div class="w-12 h-12 rounded-2xl flex items-center justify-center font-black text-xl shadow-inner ${idx === 0 ? 'bg-yellow-500 text-slate-900' : 'bg-slate-800 text-slate-600'}">
                                    ${idx === 0 ? 'üèÜ' : idx + 1}
                                </div>
                                <div class="flex flex-col">
                                    <div class="flex items-center gap-2">
                                        <span class="font-black text-lg sm:text-xl tracking-tight uppercase italic">${team.name}</span>
                                        ${isAllIn ? '<span class="bg-indigo-500 text-[8px] font-black px-2 py-0.5 rounded-md animate-pulse uppercase tracking-widest border border-indigo-400">TODO O NADA</span>' : ''}
                                    </div>
                                    <button onclick="toggleShield(${team.id})" class="text-[9px] w-fit px-2 py-0.5 rounded-full border mt-1 font-bold tracking-tighter transition-colors ${team.shield ? 'border-blue-500/50 text-blue-400 bg-blue-500/5' : 'border-slate-800 text-slate-700 line-through opacity-50'}">
                                        ESCUDO REBOTE
                                    </button>
                                </div>
                            </div>

                            <div class="flex items-center justify-between sm:justify-end gap-6 w-full sm:w-auto border-t sm:border-t-0 border-slate-800 pt-4 sm:pt-0">
                                <div class="text-right min-w-[60px]">
                                    <span class="text-3xl sm:text-4xl font-black tabular-nums tracking-tighter ${isAllIn ? 'text-indigo-400' : 'text-white'}">${team.points}</span>
                                    <span class="block text-[8px] text-slate-500 font-black uppercase tracking-tighter">Ptos</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="flex flex-col gap-1">
                                        <button onclick="handleResult(${team.id}, true)" class="bg-emerald-600 hover:bg-emerald-500 px-4 py-2 rounded-xl font-black text-xs shadow-lg active:scale-95 transition min-w-[85px]">
                                            <span class="block text-base">‚úÖ</span>
                                            <span class="text-[8px] uppercase tracking-tighter">Acierto</span>
                                        </button>
                                        <button onclick="toggleAllIn(${team.id})" class="py-1 rounded-lg text-[8px] font-black border transition-all uppercase tracking-tighter ${isAllIn ? 'bg-indigo-500 border-indigo-400 text-white' : 'bg-slate-800 border-slate-700 text-slate-500'}">
                                            ‚ö° ALL-IN
                                        </button>
                                    </div>
                                    <div class="flex flex-col gap-1">
                                        <button onclick="handleResult(${team.id}, false)" class="bg-rose-600 hover:bg-rose-500 px-4 py-2 rounded-xl font-black text-xs shadow-lg active:scale-95 transition min-w-[85px]">
                                            <span class="block text-base">‚ùå</span>
                                            <span class="text-[8px] uppercase tracking-tighter">Fallo</span>
                                        </button>
                                        <button onclick="deleteTeam(${team.id})" class="bg-slate-800 p-1 rounded-lg text-slate-700 hover:text-rose-400 transition flex justify-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // RENDER CATEGORIES
            const catsContainer = document.getElementById('categories-container');
            catsContainer.innerHTML = state.categories.map(c => `
                <div class="${c.color} px-2.5 py-1 rounded-lg text-[9px] font-black flex items-center gap-1.5 shadow-md border border-white/10 hover:scale-105 transition-transform">
                    <span class="uppercase tracking-tighter">${c.name}</span>
                    <button onclick="deleteCategory(${c.id})" class="opacity-40 hover:opacity-100 transition">‚úï</button>
                </div>
            `).join('');

            renderLogs();
        }

        // INICIALIZACI√ìN
        render();
        renderBote();

        // Service Worker Offline (In-Memory Data URL)
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE = 'h25-v1';
                const ASSETS = ['./', 'index.html', 'https://cdn.tailwindcss.com'];
                self.addEventListener('install', e => e.waitUntil(caches.open(CACHE).then(c => c.addAll(ASSETS))));
                self.addEventListener('fetch', e => e.respondWith(caches.match(e.request).then(r => r || fetch(e.request))));
            `;
            const blob = new Blob([swCode], { type: 'application/javascript' });
            navigator.serviceWorker.register(URL.createObjectURL(blob));
        }
    </script>
</body>
</html>
